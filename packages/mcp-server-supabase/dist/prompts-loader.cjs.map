{"version":3,"sources":["../src/prompts-loader.ts","../src/prompts/auth-nextjs.md","../src/prompts/database-functions.md","../src/prompts/database-schema.md","../src/prompts/edge-functions.md","../src/prompts/frontend-best-practices.md","../src/prompts/migrations.md","../src/prompts/postgres-style.md","../src/prompts/rls-policies.md"],"sourcesContent":["// ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­å¯¼å…¥æ‰€æœ‰ Markdownï¼Œå¹¶å®šä¹‰æç¤ºè¯å…ƒæ•°æ®\nimport authNextjs from './prompts/auth-nextjs.md';\nimport databaseFunctions from './prompts/database-functions.md';\nimport databaseSchema from './prompts/database-schema.md';\nimport edgeFunctions from './prompts/edge-functions.md';\nimport frontendBestPractices from './prompts/frontend-best-practices.md';\nimport migrations from './prompts/migrations.md';\nimport postgresStyle from './prompts/postgres-style.md';\nimport rlsPolicies from './prompts/rls-policies.md';\n\nexport interface PromptEntry {\n  id: string;\n  name: string;\n  description: string;\n  content: string;\n}\n\nconst entries: PromptEntry[] = [\n  {\n    id: 'auth-nextjs',\n    name: 'Bootstrap Next.js app with Supabase Auth',\n    description: 'Official prompt for setting up Supabase Auth in Next.js',\n    content: authNextjs,\n  },\n  {\n    id: 'database-functions',\n    name: 'Database: Create functions',\n    description: 'Official prompt for database functions',\n    content: databaseFunctions,\n  },\n  {\n    id: 'database-schema',\n    name: 'Database: Declarative Database Schema',\n    description: 'Official prompt for database schema design',\n    content: databaseSchema,\n  },\n  {\n    id: 'edge-functions',\n    name: 'Writing Supabase Edge Functions',\n    description: 'Official prompt for developing Edge Functions',\n    content: edgeFunctions,\n  },\n  {\n    id: 'frontend-best-practices',\n    name: 'Frontend Application Development Best Practices',\n    description: 'Comprehensive guide for frontend development best practices',\n    content: frontendBestPractices,\n  },\n  {\n    id: 'migrations',\n    name: 'Database: Create migration',\n    description: 'Official prompt for database migrations',\n    content: migrations,\n  },\n  {\n    id: 'postgres-style',\n    name: 'Postgres SQL Style Guide',\n    description: 'Official PostgreSQL SQL style guide',\n    content: postgresStyle,\n  },\n  {\n    id: 'rls-policies',\n    name: 'Database: Create RLS policies',\n    description: 'Official prompt for Row Level Security policies',\n    content: rlsPolicies,\n  },\n];\n\nexport interface LoadedPrompt {\n  name: string;\n  description: string;\n  content: string;\n}\n\nexport class PromptsProvider {\n\n  /**\n   * åŠ è½½æ‰€æœ‰æç¤ºè¯æ–‡ä»¶\n   */\n  async getAllPrompts(): Promise<LoadedPrompt[]> {\n    return entries.map(this.fromEntry);\n  }\n\n\n  /**\n   * æ ¹æ®æ–‡ä»¶åå’Œå†…å®¹ç”Ÿæˆèµ„æºå¯¹è±¡\n   */\n  private fromEntry = (entry: PromptEntry): LoadedPrompt => ({\n    name: entry.name,\n    description: entry.description,\n    content: entry.content,\n  });\n}\n\n// å¯¼å‡ºå•ä¾‹å®ä¾‹\nexport const promptsProvider = new PromptsProvider();\n","# Bootstrap Next.js app with Supabase Auth\n\n## ğŸ¯ ç›®æ ‡\nåœ¨ Next.js åº”ç”¨ä¸­å¿«é€Ÿè®¾ç½® Supabase è®¤è¯ç³»ç»Ÿã€‚\n\n## ğŸ› ï¸ æ‰€éœ€å·¥å…·\n- Next.js é¡¹ç›®\n- Supabase é¡¹ç›®\n- Supabase JavaScript å®¢æˆ·ç«¯\n\n## ğŸš€ å®ç°æ­¥éª¤\n\n### 1. å®‰è£…ä¾èµ–\n```bash\nnpm install @supabase/supabase-js @supabase/auth-helpers-nextjs\n```\n\n### 2. ç¯å¢ƒå˜é‡é…ç½®\n```env\nNEXT_PUBLIC_SUPABASE_URL=your_supabase_url\nNEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key\n```\n\n### 3. åˆ›å»º Supabase å®¢æˆ·ç«¯\n```typescript\n// lib/supabase.ts\nimport { createClient } from '@supabase/supabase-js'\n\nexport const supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n)\n```\n\n### 4. è®¤è¯ç»„ä»¶ç¤ºä¾‹\n```typescript\n// components/Auth.tsx\nimport { useState } from 'react'\nimport { supabase } from '../lib/supabase'\n\nexport default function Auth() {\n  const [loading, setLoading] = useState(false)\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n\n  const handleSignUp = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n    \n    const { error } = await supabase.auth.signUp({\n      email,\n      password,\n    })\n    \n    if (error) console.log('Error:', error.message)\n    else alert('Check your email for the confirmation link!')\n    setLoading(false)\n  }\n\n  const handleSignIn = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n    \n    const { error } = await supabase.auth.signInWithPassword({\n      email,\n      password,\n    })\n    \n    if (error) console.log('Error:', error.message)\n    setLoading(false)\n  }\n\n  return (\n    <div className=\"auth-container\">\n      <form onSubmit={handleSignUp}>\n        <input\n          type=\"email\"\n          placeholder=\"Your email\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)}\n        />\n        <input\n          type=\"password\"\n          placeholder=\"Your password\"\n          value={password}\n          onChange={(e) => setPassword(e.target.value)}\n        />\n        <button type=\"submit\" disabled={loading}>\n          {loading ? 'Loading...' : 'Sign Up'}\n        </button>\n      </form>\n      \n      <form onSubmit={handleSignIn}>\n        <button type=\"submit\" disabled={loading}>\n          {loading ? 'Loading...' : 'Sign In'}\n        </button>\n      </form>\n    </div>\n  )\n}\n```\n\n## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ\n- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯\n- å®ç°é€‚å½“çš„é”™è¯¯å¤„ç†\n- æ·»åŠ åŠ è½½çŠ¶æ€å’Œç”¨æˆ·åé¦ˆ\n- è€ƒè™‘å®ç°å¯†ç å¼ºåº¦éªŒè¯\n\n## ğŸ“š ç›¸å…³èµ„æº\n- [Supabase Auth Documentation](https://supabase.com/docs/guides/auth)\n- [Next.js Documentation](https://nextjs.org/docs)\n\n\n","# Database: Create functions\n\n## ğŸ¯ ç›®æ ‡\nåˆ›å»ºé«˜æ•ˆã€å¯ç»´æŠ¤çš„æ•°æ®åº“å‡½æ•°ï¼Œæå‡åº”ç”¨æ€§èƒ½å’Œæ•°æ®ä¸€è‡´æ€§ã€‚\n\n## ğŸ—ï¸ å‡½æ•°ç±»å‹\n\n### 1. æ ‡é‡å‡½æ•°\n```sql\n-- è®¡ç®—ç”¨æˆ·å¹´é¾„\nCREATE OR REPLACE FUNCTION calculate_age(birth_date DATE)\nRETURNS INTEGER AS $$\nBEGIN\n  RETURN EXTRACT(YEAR FROM AGE(birth_date));\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE;\n\n-- æ ¼å¼åŒ–é‡‘é¢\nCREATE OR REPLACE FUNCTION format_currency(amount DECIMAL, currency_code VARCHAR(3))\nRETURNS VARCHAR AS $$\nBEGIN\n  RETURN currency_code || ' ' || TO_CHAR(amount, 'FM999,999,999.00');\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE;\n```\n\n### 2. è¡¨å‡½æ•°\n```sql\n-- è·å–ç”¨æˆ·è®¢å•ç»Ÿè®¡\nCREATE OR REPLACE FUNCTION get_user_order_stats(user_uuid UUID)\nRETURNS TABLE (\n  total_orders BIGINT,\n  total_spent DECIMAL(10,2),\n  avg_order_value DECIMAL(10,2),\n  last_order_date TIMESTAMP WITH TIME ZONE\n) AS $$\nBEGIN\n  RETURN QUERY\n  SELECT \n    COUNT(o.id)::BIGINT,\n    COALESCE(SUM(o.total_amount), 0),\n    COALESCE(AVG(o.total_amount), 0),\n    MAX(o.created_at)\n  FROM orders o\n  WHERE o.user_id = user_uuid;\nEND;\n$$ LANGUAGE plpgsql STABLE;\n```\n\n### 3. è§¦å‘å™¨å‡½æ•°\n```sql\n-- è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- åˆ›å»ºè§¦å‘å™¨\nCREATE TRIGGER update_users_updated_at\n  BEFORE UPDATE ON users\n  FOR EACH ROW\n  EXECUTE FUNCTION update_updated_at_column();\n```\n\n## ğŸ”’ å®‰å…¨å‡½æ•°\n\n### 1. æ•°æ®éªŒè¯å‡½æ•°\n```sql\n-- éªŒè¯é‚®ç®±æ ¼å¼\nCREATE OR REPLACE FUNCTION is_valid_email(email TEXT)\nRETURNS BOOLEAN AS $$\nBEGIN\n  RETURN email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$';\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE;\n\n-- éªŒè¯å¯†ç å¼ºåº¦\nCREATE OR REPLACE FUNCTION is_strong_password(password TEXT)\nRETURNS BOOLEAN AS $$\nBEGIN\n  RETURN \n    LENGTH(password) >= 8 AND\n    password ~ '[A-Z]' AND\n    password ~ '[a-z]' AND\n    password ~ '[0-9]' AND\n    password ~ '[^A-Za-z0-9]';\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE;\n```\n\n### 2. æƒé™æ£€æŸ¥å‡½æ•°\n```sql\n-- æ£€æŸ¥ç”¨æˆ·æƒé™\nCREATE OR REPLACE FUNCTION check_user_permission(\n  user_uuid UUID,\n  required_permission TEXT\n)\nRETURNS BOOLEAN AS $$\nDECLARE\n  has_permission BOOLEAN;\nBEGIN\n  SELECT EXISTS(\n    SELECT 1 FROM user_permissions up\n    JOIN permissions p ON up.permission_id = p.id\n    WHERE up.user_id = user_uuid\n    AND p.name = required_permission\n    AND up.is_active = true\n  ) INTO has_permission;\n  \n  RETURN has_permission;\nEND;\n$$ LANGUAGE plpgsql STABLE;\n```\n\n## ğŸ”„ äº‹åŠ¡å‡½æ•°\n\n### 1. å¤æ‚ä¸šåŠ¡é€»è¾‘\n```sql\n-- å¤„ç†è®¢å•æ”¯ä»˜\nCREATE OR REPLACE FUNCTION process_order_payment(\n  order_uuid UUID,\n  payment_amount DECIMAL(10,2),\n  payment_method TEXT\n)\nRETURNS BOOLEAN AS $$\nDECLARE\n  order_record RECORD;\n  user_record RECORD;\nBEGIN\n  -- å¼€å§‹äº‹åŠ¡\n  BEGIN\n    -- è·å–è®¢å•ä¿¡æ¯\n    SELECT * INTO order_record FROM orders WHERE id = order_uuid;\n    IF NOT FOUND THEN\n      RAISE EXCEPTION 'Order not found';\n    END IF;\n    \n    -- è·å–ç”¨æˆ·ä¿¡æ¯\n    SELECT * INTO user_record FROM users WHERE id = order_record.user_id;\n    \n    -- éªŒè¯æ”¯ä»˜é‡‘é¢\n    IF payment_amount != order_record.total_amount THEN\n      RAISE EXCEPTION 'Payment amount mismatch';\n    END IF;\n    \n    -- æ›´æ–°è®¢å•çŠ¶æ€\n    UPDATE orders \n    SET \n      status = 'paid',\n      payment_method = payment_method,\n      paid_at = NOW(),\n      updated_at = NOW()\n    WHERE id = order_uuid;\n    \n    -- è®°å½•æ”¯ä»˜å†å²\n    INSERT INTO payment_history (\n      order_id, amount, method, processed_at\n    ) VALUES (\n      order_uuid, payment_amount, payment_method, NOW()\n    );\n    \n    -- æäº¤äº‹åŠ¡\n    RETURN true;\n    \n  EXCEPTION\n    WHEN OTHERS THEN\n      -- å›æ»šäº‹åŠ¡\n      RAISE;\n  END;\nEND;\n$$ LANGUAGE plpgsql;\n```\n\n## âš¡ æ€§èƒ½ä¼˜åŒ–\n\n### 1. å‡½æ•°å±æ€§\n```sql\n-- ä¸å¯å˜å‡½æ•°ï¼ˆç›¸åŒè¾“å…¥æ€»æ˜¯è¿”å›ç›¸åŒè¾“å‡ºï¼‰\nCREATE OR REPLACE FUNCTION get_user_by_id(user_id UUID)\nRETURNS users AS $$\n  SELECT * FROM users WHERE id = user_id;\n$$ LANGUAGE sql IMMUTABLE;\n\n-- ç¨³å®šå‡½æ•°ï¼ˆç›¸åŒè¾“å…¥åœ¨äº‹åŠ¡å†…è¿”å›ç›¸åŒè¾“å‡ºï¼‰\nCREATE OR REPLACE FUNCTION get_user_profile(user_id UUID)\nRETURNS user_profiles AS $$\n  SELECT * FROM user_profiles WHERE user_id = $1;\n$$ LANGUAGE sql STABLE;\n\n-- æ˜“å˜å‡½æ•°ï¼ˆå¯èƒ½è¿”å›ä¸åŒç»“æœï¼‰\nCREATE OR REPLACE FUNCTION get_current_timestamp()\nRETURNS TIMESTAMP WITH TIME ZONE AS $$\n  SELECT NOW();\n$$ LANGUAGE sql VOLATILE;\n```\n\n### 2. å¹¶è¡Œæ‰§è¡Œ\n```sql\n-- æ”¯æŒå¹¶è¡Œæ‰§è¡Œçš„å‡½æ•°\nCREATE OR REPLACE FUNCTION parallel_process_data(data_array INTEGER[])\nRETURNS INTEGER AS $$\nBEGIN\n  RETURN array_length(data_array, 1);\nEND;\n$$ LANGUAGE plpgsql PARALLEL SAFE;\n```\n\n## ğŸ§ª æµ‹è¯•å‡½æ•°\n\n### 1. å•å…ƒæµ‹è¯•\n```sql\n-- æµ‹è¯•å‡½æ•°\nCREATE OR REPLACE FUNCTION test_calculate_age()\nRETURNS BOOLEAN AS $$\nDECLARE\n  test_result INTEGER;\nBEGIN\n  -- æµ‹è¯•ç”¨ä¾‹ 1\n  test_result := calculate_age('1990-01-01'::DATE);\n  IF test_result != 34 THEN\n    RAISE EXCEPTION 'Test failed: expected 34, got %', test_result;\n  END IF;\n  \n  -- æµ‹è¯•ç”¨ä¾‹ 2\n  test_result := calculate_age('2000-01-01'::DATE);\n  IF test_result != 24 THEN\n    RAISE EXCEPTION 'Test failed: expected 24, got %', test_result;\n  END IF;\n  \n  RETURN true;\nEND;\n$$ LANGUAGE plpgsql;\n```\n\n## ğŸ“š ç›¸å…³èµ„æº\n- [PostgreSQL Functions Documentation](https://www.postgresql.org/docs/current/xfunc.html)\n- [Supabase Database Functions](https://supabase.com/docs/guides/database/functions)\n\n\n","# Database: Declarative Database Schema\n\n## ğŸ¯ ç›®æ ‡\nä½¿ç”¨å£°æ˜å¼æ–¹æ³•è®¾è®¡æ¸…æ™°ã€å¯ç»´æŠ¤çš„æ•°æ®åº“æ¨¡å¼ã€‚\n\n## ğŸ—ï¸ æ¨¡å¼è®¾è®¡åŸåˆ™\n\n### 1. å‘½åçº¦å®š\n- è¡¨åä½¿ç”¨å¤æ•°å½¢å¼ï¼š`users`, `orders`, `products`\n- å­—æ®µåä½¿ç”¨å°å†™å’Œä¸‹åˆ’çº¿ï¼š`user_id`, `created_at`, `is_active`\n- çº¦æŸåä½¿ç”¨æè¿°æ€§åç§°ï¼š`fk_user_orders`, `idx_users_email`\n\n### 2. æ•°æ®ç±»å‹é€‰æ‹©\n```sql\n-- ç”¨æˆ·è¡¨ç¤ºä¾‹\nCREATE TABLE users (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  email VARCHAR(255) UNIQUE NOT NULL,\n  username VARCHAR(50) UNIQUE NOT NULL,\n  full_name VARCHAR(100),\n  avatar_url TEXT,\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- è®¢å•è¡¨ç¤ºä¾‹\nCREATE TABLE orders (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  order_number VARCHAR(20) UNIQUE NOT NULL,\n  total_amount DECIMAL(10,2) NOT NULL CHECK (total_amount > 0),\n  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'confirmed', 'shipped', 'delivered', 'cancelled')),\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n```\n\n### 3. ç´¢å¼•ç­–ç•¥\n```sql\n-- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•\nCREATE INDEX idx_users_email ON users(email);\nCREATE INDEX idx_users_username ON users(username);\nCREATE INDEX idx_orders_user_id ON orders(user_id);\nCREATE INDEX idx_orders_status ON orders(status);\nCREATE INDEX idx_orders_created_at ON orders(created_at);\n\n-- å¤åˆç´¢å¼•\nCREATE INDEX idx_orders_user_status ON orders(user_id, status);\n```\n\n### 4. çº¦æŸå’ŒéªŒè¯\n```sql\n-- æ£€æŸ¥çº¦æŸ\nALTER TABLE users ADD CONSTRAINT chk_email_format \n  CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$');\n\n-- å¤–é”®çº¦æŸ\nALTER TABLE orders ADD CONSTRAINT fk_orders_user \n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;\n\n-- å”¯ä¸€çº¦æŸ\nALTER TABLE users ADD CONSTRAINT uk_users_email UNIQUE (email);\n```\n\n## ğŸ”„ æ¨¡å¼æ¼”è¿›\n\n### 1. ä½¿ç”¨è¿ç§»æ–‡ä»¶\n```sql\n-- migrations/001_create_users_table.sql\nCREATE TABLE users (\n  -- è¡¨ç»“æ„\n);\n\n-- migrations/002_add_user_profile.sql\nALTER TABLE users ADD COLUMN profile_data JSONB;\n```\n\n### 2. å‘åå…¼å®¹æ€§\n```sql\n-- æ·»åŠ æ–°å­—æ®µæ—¶æä¾›é»˜è®¤å€¼\nALTER TABLE users ADD COLUMN phone VARCHAR(20) DEFAULT NULL;\n\n-- åˆ é™¤å­—æ®µå‰å…ˆæ ‡è®°ä¸ºåºŸå¼ƒ\nALTER TABLE users ADD COLUMN is_deprecated BOOLEAN DEFAULT false;\n```\n\n## âš¡ æ€§èƒ½ä¼˜åŒ–\n\n### 1. åˆ†åŒºç­–ç•¥\n```sql\n-- æŒ‰æ—¶é—´åˆ†åŒº\nCREATE TABLE orders (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n  -- å…¶ä»–å­—æ®µ\n) PARTITION BY RANGE (created_at);\n\n-- åˆ›å»ºåˆ†åŒº\nCREATE TABLE orders_2024 PARTITION OF orders\n  FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');\n```\n\n### 2. ç‰©åŒ–è§†å›¾\n```sql\n-- åˆ›å»ºç‰©åŒ–è§†å›¾\nCREATE MATERIALIZED VIEW user_order_summary AS\nSELECT \n  u.id,\n  u.email,\n  COUNT(o.id) as order_count,\n  SUM(o.total_amount) as total_spent\nFROM users u\nLEFT JOIN orders o ON u.id = o.user_id\nGROUP BY u.id, u.email;\n\n-- å®šæœŸåˆ·æ–°\nREFRESH MATERIALIZED VIEW user_order_summary;\n```\n\n## ğŸ”’ å®‰å…¨è€ƒè™‘\n- ä½¿ç”¨ RLS (Row Level Security) æ§åˆ¶æ•°æ®è®¿é—®\n- å®ç°é€‚å½“çš„æƒé™ç®¡ç†\n- å®šæœŸå®¡è®¡æ•°æ®åº“è®¿é—®\n- åŠ å¯†æ•æ„Ÿæ•°æ®\n\n## ğŸ“š ç›¸å…³èµ„æº\n- [PostgreSQL Documentation](https://www.postgresql.org/docs/)\n- [Supabase Database Guide](https://supabase.com/docs/guides/database)\n\n\n","# Writing Supabase Edge Functions\n\n## ğŸ¯ ç›®æ ‡\nå¼€å‘é«˜æ•ˆã€å®‰å…¨çš„ Supabase Edge Functionsã€‚\n\n## ğŸ“ å‡½æ•°æ¨¡æ¿\n\n### åŸºç¡€å‡½æ•°ç»“æ„\n```typescript\n// supabase/functions/my-function/index.ts\nimport { serve } from \"https://deno.land/std@0.168.0/http/server.ts\"\n\nserve(async (req) => {\n  try {\n    // è·å–è¯·æ±‚æ•°æ®\n    const { name } = await req.json()\n    \n    // ä¸šåŠ¡é€»è¾‘\n    const message = `Hello ${name}!`\n    \n    // è¿”å›å“åº”\n    return new Response(\n      JSON.stringify({ message }),\n      { \n        headers: { \"Content-Type\": \"application/json\" },\n        status: 200 \n      }\n    )\n  } catch (error) {\n    return new Response(\n      JSON.stringify({ error: error.message }),\n      { \n        headers: { \"Content-Type\": \"application/json\" },\n        status: 400 \n      }\n    )\n  }\n})\n```\n\n### æ•°æ®åº“æ“ä½œå‡½æ•°\n```typescript\nimport { serve } from \"https://deno.land/std@0.168.0/http/server.ts\"\nimport { createClient } from 'https://esm.sh/@supabase/supabase-js@2'\n\nserve(async (req) => {\n  // åˆ›å»º Supabase å®¢æˆ·ç«¯\n  const supabaseClient = createClient(\n    Deno.env.get('SUPABASE_URL') ?? '',\n    Deno.env.get('SUPABASE_ANON_KEY') ?? ''\n  )\n  \n  try {\n    const { data, error } = await supabaseClient\n      .from('users')\n      .select('*')\n      .limit(10)\n    \n    if (error) throw error\n    \n    return new Response(\n      JSON.stringify({ data }),\n      { headers: { \"Content-Type\": \"application/json\" } }\n    )\n  } catch (error) {\n    return new Response(\n      JSON.stringify({ error: error.message }),\n      { \n        headers: { \"Content-Type\": \"application/json\" },\n        status: 400 \n      }\n    )\n  }\n})\n```\n\n## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ\n- éªŒè¯ JWT ä»¤ç‰Œ\n- å®ç°é€‚å½“çš„é”™è¯¯å¤„ç†\n- ç›®å‰ä¸æ”¯æŒä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯\n\n## ğŸš€ éƒ¨ç½²å’Œæµ‹è¯•\né‡è¦ï¼šä¸æ”¯æŒåŸºäº supabase cli çš„ Edge Functions éƒ¨ç½²æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡ PolarDB Supabase MCP è¿›è¡Œ Edge Functions ç®¡ç†ã€‚\n\n## ğŸ“š ç›¸å…³èµ„æº\n- [Edge Functions Documentation](https://supabase.com/docs/guides/functions)\n- [Deno Runtime](https://deno.land/)\n\n\n","# åŸºäº PolarDB Supabase çš„å‰ç«¯åº”ç”¨å¼€å‘æœ€ä½³å®è·µ\n\n## ğŸ¯ æ ¸å¿ƒèº«ä»½\nä½ æ˜¯ä¸€åä¸“ä¸š AI åŠ©æ‰‹å’Œå“è¶Šçš„è½¯ä»¶å¼€å‘ä¸“å®¶ï¼Œåœ¨å¤šç§ç¼–ç¨‹è¯­è¨€ã€æ¡†æ¶å’Œæœ€ä½³å®è·µæ–¹é¢æ‹¥æœ‰ä¸°å¯Œçš„çŸ¥è¯†ã€‚\n\n## ğŸ“‹ å“åº”è¦æ±‚\n1. **è®¾è®¡è´¨é‡**ï¼šæ‰€æœ‰è®¾è®¡è¯·æ±‚å¿…é¡»æ˜¯ä¸“ä¸šã€ç¾è§‚ã€ç‹¬ç‰¹ä¸”åŠŸèƒ½å®Œæ•´çš„ç”Ÿäº§çº§è´¨é‡\n3. **ä¸“æ³¨æ€§**ï¼šä¸“æ³¨äºè§£å†³ç”¨æˆ·è¯·æ±‚ï¼Œä¸åç¦»åˆ°ä¸ç›¸å…³è¯é¢˜\n4. **è¯­è¨€åŒ¹é…**ï¼šä½¿ç”¨ç”¨æˆ·æé—®çš„è¯­è¨€æ¥å›ç­”\n\n## ğŸ› ï¸ æŠ€æœ¯åå¥½\n- **æ•°æ®åº“**ï¼šé»˜è®¤ä½¿ç”¨ Supabase ä½œä¸ºæ•°æ®åº“ï¼Œé™¤éå¦æœ‰è¯´æ˜\n- **å›¾ç‰‡èµ„æº**ï¼šä½¿ç”¨æ¥è‡ª Pexels æˆ– Unsplash çš„åº“å­˜ç…§ç‰‡ï¼ˆä»…é™æœ‰æ•ˆ URLï¼‰\n\n### é¡¹ç›®è®¾ç½®æé†’\n- å¦‚æœ .env æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»º .env æ–‡ä»¶ï¼ŒåŒ…å«å¿…è¦å˜é‡\n- .env éœ€è¦åŒ…å« Supabase è¿æ¥ä¿¡æ¯ VITE_SUPABASE_URLã€VITE_SUPABASE_ANON_KEYï¼Œå€¼å¯ä»¥é€šè¿‡ PolarDB Supabase MCP è·å–åˆ°ã€‚\n\n### å®¢æˆ·ç«¯è®¾ç½®\n- ä½¿ç”¨ @supabase/supabase-js\n- åˆ›å»ºå•ä¾‹å®¢æˆ·ç«¯å®ä¾‹\n- ä½¿ç”¨ .env ä¸­çš„ç¯å¢ƒå˜é‡\n\n### è®¤è¯è¦æ±‚\n- å§‹ç»ˆä½¿ç”¨ç”µå­é‚®ä»¶/å¯†ç æ³¨å†Œ\n- **ç¦æ­¢**ï¼šè‡ªå®šä¹‰è®¤è¯ç³»ç»Ÿï¼Œå§‹ç»ˆä½¿ç”¨ Supabase çš„å†…ç½®è®¤è¯\n\n## ğŸ¨ è®¾è®¡æŒ‡ä»¤\n\n### æ ¸å¿ƒè®¾è®¡æ ‡å‡†\n- **è´¨é‡è¦æ±‚**ï¼šåˆ›é€ ä»¤äººæƒŠå¹ã€æ²‰æµ¸å¼çš„è®¾è®¡ï¼Œåª²ç¾è‹¹æœã€Stripe æˆ–å¥¢ä¾ˆå“ç‰Œçš„ç²¾è‡´åº¦\n- **åŠŸèƒ½å®Œæ•´**ï¼šè®¾è®¡å¿…é¡»å¯ç›´æ¥ç”Ÿäº§ï¼ŒåŠŸèƒ½å®Œå¤‡ï¼Œä¸ä½¿ç”¨å ä½ç¬¦\n- **ç‹¬ç‰¹æ€§**ï¼šä¸¥ç¦ä½¿ç”¨é€šç”¨æˆ–æ¨¡æ¿åŒ–ç¾å­¦ï¼Œæ¯ä¸ªè®¾è®¡å¿…é¡»æ‹¥æœ‰ç‹¬ç‰¹çš„å“ç‰Œä¸“å±è§†è§‰æ ‡è¯†\n- **æ ‡é¢˜è®¾è®¡**ï¼šå¿…é¡»åŠ¨æ€ã€æ²‰æµ¸ä¸”ä»¥æ•…äº‹é©±åŠ¨ï¼Œä½¿ç”¨åˆ†å±‚è§†è§‰æ•ˆæœã€åŠ¨æ•ˆå’Œè±¡å¾å…ƒç´ \n- **åŠ¨ç”»æ•ˆæœ**ï¼šèå…¥æœ‰ç›®çš„çš„è½»é‡çº§åŠ¨ç”»ï¼Œç”¨äºæ»šåŠ¨æ­ç¤ºã€å¾®äº¤äº’å’ŒåŒºåŸŸè¿‡æ¸¡\n\n### è®¾è®¡åŸåˆ™\n- è¾¾åˆ°è‹¹æœçº§åˆ«çš„ç²¾è‡´ï¼Œæ³¨é‡ç»†èŠ‚\n- æä¾›åŠŸèƒ½å®Œå¤‡çš„äº¤äº’ç»„ä»¶ï¼Œå…·å¤‡ç›´è§‚çš„åé¦ˆçŠ¶æ€\n- ä½¿ç”¨å®šåˆ¶æ’ç”»ã€3D å…ƒç´ æˆ–è±¡å¾æ€§è§†è§‰å…ƒç´ \n- ç¡®ä¿è®¾è®¡å……æ»¡æ´»åŠ›ä¸”ç°ä»£ï¼Œé€šè¿‡æ¸å˜ã€è¾‰å…‰æˆ–è§†å·®æ•ˆæœç­‰åŠ¨æ€å…ƒç´ \n- æœ€ç»ˆå®šç¨¿å‰è‡ªé—®ï¼š\"è¿™ä¸ªè®¾è®¡èƒ½å¦è®© Apple æˆ– Stripe çš„è®¾è®¡å¸ˆé©»è¶³å…³æ³¨ï¼Ÿ\"\n\n### é¿å…çš„è®¾è®¡\n- æœªç»æ˜¾è‘—å®šåˆ¶æ‰“ç£¨çš„åŸºæœ¬å¸ƒå±€\n- ç®€å•åŒ–çš„é¡µçœ‰ï¼Œå¿…é¡»å…·æœ‰æ²‰æµ¸æ„Ÿã€åŠ¨ç”»æ•ˆæœ\n- å¯èƒ½è¢«è¯¯è®¤ä¸ºå…è´¹æ¨¡æ¿æˆ–è¿‡åº¦ä½¿ç”¨çš„æ¨¡å¼\n\n### äº¤äº’æ¨¡å¼\n- ä½¿ç”¨æ¸è¿›å¼æŠ«éœ²æ¥å¼•å¯¼ç”¨æˆ·ç›´è§‚æ“ä½œ\n- ç»“åˆä¸Šä¸‹æ–‡èœå•ã€æ™ºèƒ½æç¤ºå’Œè§†è§‰æç¤º\n- å®ç°æ‹–æ”¾ã€æ‚¬åœæ•ˆæœå’Œè¿‡æ¸¡åŠ¨ç”»\n- æ”¯æŒé”®ç›˜å¿«æ·é”®ã€ARIA æ ‡ç­¾å’Œç„¦ç‚¹çŠ¶æ€\n- æ·»åŠ å¾®å¦™çš„è§†å·®æ•ˆæœæˆ–æ»šåŠ¨è§¦å‘çš„åŠ¨ç”»\n\n### æŠ€æœ¯è¦æ±‚\n- ç²¾å¿ƒæŒ‘é€‰çš„é¢œè‰²è°ƒè‰²æ¿ï¼ˆ3-5 ç§å¯Œæœ‰è¡¨ç°åŠ›çš„é¢œè‰²+ä¸­æ€§è‰²ï¼‰\n- ç¡®ä¿æ‰€æœ‰æ–‡æœ¬å’Œäº¤äº’å…ƒç´ è‡³å°‘å…·æœ‰ 4.5:1 çš„å¯¹æ¯”åº¦\n- ä½¿ç”¨å¯Œæœ‰è¡¨ç°åŠ›ä¸”æ˜“äºé˜…è¯»çš„å­—ä½“ï¼ˆæ­£æ–‡ä¸å°äº 18pxï¼Œæ ‡é¢˜ä¸å°äº 40pxï¼‰\n- è®¾è®¡ä¸ºå…¨å“åº”å¼ï¼Œç¡®ä¿åœ¨æ‰€æœ‰å±å¹•å°ºå¯¸ä¸Šå‡èƒ½å®Œç¾è¿è¡Œ\n- éµå¾ª WCAG 2.1 AA æŒ‡å—\n- éµå¾ª 8px ç½‘æ ¼ç³»ç»Ÿ\n- é€šè¿‡ç»†å¾®çš„é˜´å½±ã€æ¸å˜ã€è¾‰å…‰å’Œåœ†è§’å¢åŠ æ·±åº¦\n- ä¼˜åŒ–åŠ¨ç”»å’Œäº¤äº’ï¼Œç¡®ä¿è·¨è®¾å¤‡çš„æµç•…ä½“éªŒ\n\n### ç»„ä»¶è¦æ±‚\n- è®¾è®¡å…·æœ‰ä¸€è‡´æ ·å¼ã€è¡Œä¸ºå’Œåé¦ˆçŠ¶æ€çš„å¯é‡ç”¨ã€æ¨¡å—åŒ–ç»„ä»¶\n- åŒ…å«æœ‰ç›®çš„çš„åŠ¨ç”»æ¥å¼•å¯¼æ³¨æ„åŠ›å¹¶å¢å¼ºäº¤äº’æ€§\n- ç¡®ä¿å®Œæ•´çš„æ— éšœç¢æ”¯æŒ\n- ä½¿ç”¨è‡ªå®šä¹‰å›¾æ ‡æˆ–æ’å›¾æ¥å¼ºåŒ–ç»„ä»¶çš„å“ç‰Œè§†è§‰è¯†åˆ«\n\n\n","# Database: Create migration\n\n## ğŸ¯ ç›®æ ‡\nåˆ›å»ºå®‰å…¨ã€å¯å›æ»šçš„æ•°æ®åº“è¿ç§»ï¼Œç®¡ç†æ•°æ®åº“æ¨¡å¼çš„æ¼”è¿›ã€‚\n\n## ğŸ—ï¸ è¿ç§»åŸºç¡€\n\n### 1. è¿ç§»æ–‡ä»¶å‘½å\n```bash\n# æ ¼å¼ï¼šYYYYMMDDHHMMSS_description.sql\n20241220120000_create_users_table.sql\n20241220120001_add_user_profile.sql\n20241220120002_create_orders_table.sql\n```\n\n### 2. è¿ç§»æ–‡ä»¶ç»“æ„\n```sql\n-- è¿ç§»æ–‡ä»¶ï¼š20241220120000_create_users_table.sql\n\n-- å‘ä¸Šè¿ç§»\nCREATE TABLE users (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  email VARCHAR(255) UNIQUE NOT NULL,\n  username VARCHAR(50) UNIQUE NOT NULL,\n  full_name VARCHAR(100),\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- åˆ›å»ºç´¢å¼•\nCREATE INDEX idx_users_email ON users(email);\nCREATE INDEX idx_users_username ON users(username);\n\n-- å‘ä¸‹è¿ç§»ï¼ˆå›æ»šï¼‰\n-- DROP TABLE users CASCADE;\n```\n\n## ğŸ”„ è¿ç§»ç±»å‹\n\n### 1. è¡¨ç»“æ„è¿ç§»\n```sql\n-- åˆ›å»ºè¡¨\nCREATE TABLE products (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  price DECIMAL(10,2) NOT NULL CHECK (price > 0),\n  category_id UUID REFERENCES categories(id),\n  is_active BOOLEAN DEFAULT true,\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- æ·»åŠ å­—æ®µ\nALTER TABLE users ADD COLUMN phone VARCHAR(20);\nALTER TABLE users ADD COLUMN avatar_url TEXT;\n\n-- ä¿®æ”¹å­—æ®µ\nALTER TABLE users ALTER COLUMN email TYPE VARCHAR(320);\nALTER TABLE users ALTER COLUMN username SET NOT NULL;\n\n-- åˆ é™¤å­—æ®µ\nALTER TABLE users DROP COLUMN phone;\n```\n\n### 2. æ•°æ®è¿ç§»\n```sql\n-- æ’å…¥åˆå§‹æ•°æ®\nINSERT INTO categories (name, description) VALUES\n  ('Electronics', 'Electronic devices and accessories'),\n  ('Clothing', 'Apparel and fashion items'),\n  ('Books', 'Books and publications');\n\n-- æ›´æ–°ç°æœ‰æ•°æ®\nUPDATE users \nSET full_name = CONCAT(first_name, ' ', last_name)\nWHERE full_name IS NULL;\n\n-- æ•°æ®æ¸…ç†\nDELETE FROM users WHERE created_at < '2020-01-01';\n```\n\n### 3. ç´¢å¼•è¿ç§»\n```sql\n-- åˆ›å»ºç´¢å¼•\nCREATE INDEX idx_products_category ON products(category_id);\nCREATE INDEX idx_products_price ON products(price);\nCREATE INDEX idx_products_active ON products(is_active) WHERE is_active = true;\n\n-- åˆ é™¤ç´¢å¼•\nDROP INDEX IF EXISTS idx_products_old;\n```\n\n## ğŸ”’ å®‰å…¨è¿ç§»\n\n### 1. äº‹åŠ¡åŒ…è£…\n```sql\n-- ä½¿ç”¨äº‹åŠ¡ç¡®ä¿åŸå­æ€§\nBEGIN;\n\n-- æ‰§è¡Œè¿ç§»æ“ä½œ\nCREATE TABLE new_users (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  email VARCHAR(255) UNIQUE NOT NULL,\n  username VARCHAR(50) UNIQUE NOT NULL\n);\n\n-- å¤åˆ¶æ•°æ®\nINSERT INTO new_users (id, email, username)\nSELECT id, email, username FROM users;\n\n-- é‡å‘½åè¡¨\nALTER TABLE users RENAME TO users_old;\nALTER TABLE new_users RENAME TO users;\n\nCOMMIT;\n```\n\n### 2. å›æ»šå‡†å¤‡\n```sql\n-- åœ¨è¿ç§»å‰åˆ›å»ºå¤‡ä»½\nCREATE TABLE users_backup AS SELECT * FROM users;\n\n-- æˆ–è€…ä½¿ç”¨ä¸´æ—¶è¡¨\nCREATE TEMP TABLE users_temp AS SELECT * FROM users;\n```\n\n### 3. æ•°æ®éªŒè¯\n```sql\n-- è¿ç§»åéªŒè¯æ•°æ®å®Œæ•´æ€§\nSELECT COUNT(*) FROM users;\nSELECT COUNT(*) FROM users_backup;\n\n-- éªŒè¯å…³é”®æ•°æ®\nSELECT COUNT(*) FROM users WHERE email IS NULL;\nSELECT COUNT(*) FROM users WHERE username IS NULL;\n```\n\n## âš¡ æ€§èƒ½ä¼˜åŒ–\n\n### 1. æ‰¹é‡æ“ä½œ\n```sql\n-- æ‰¹é‡æ’å…¥\nINSERT INTO products (name, price, category_id)\nSELECT \n  'Product ' || generate_series(1, 1000),\n  random() * 1000,\n  (random() * 5 + 1)::int\nFROM generate_series(1, 1000);\n\n-- æ‰¹é‡æ›´æ–°\nUPDATE products \nSET price = price * 1.1\nWHERE category_id = 1;\n```\n\n### 2. å¹¶å‘æ§åˆ¶\n```sql\n-- ä½¿ç”¨ LOCK é¿å…å¹¶å‘é—®é¢˜\nLOCK TABLE users IN ACCESS EXCLUSIVE MODE;\n\n-- æˆ–è€…ä½¿ç”¨è¡Œçº§é”\nSELECT * FROM users WHERE id = 'user-uuid' FOR UPDATE;\n```\n\n## ğŸ§ª æµ‹è¯•è¿ç§»\n\n### 1. æœ¬åœ°æµ‹è¯•\n```bash\n# åœ¨æœ¬åœ°ç¯å¢ƒæµ‹è¯•è¿ç§»\nsupabase db reset\nsupabase db push\n\n# éªŒè¯è¿ç§»ç»“æœ\nsupabase db diff\n```\n\n### 2. è¿ç§»éªŒè¯\n```sql\n-- æ£€æŸ¥è¡¨ç»“æ„\n\\d users\n\n-- æ£€æŸ¥ç´¢å¼•\nSELECT indexname, indexdef FROM pg_indexes WHERE tablename = 'users';\n\n-- æ£€æŸ¥çº¦æŸ\nSELECT conname, contype, pg_get_constraintdef(oid) \nFROM pg_constraint \nWHERE conrelid = 'users'::regclass;\n```\n\n## ğŸ“‹ è¿ç§»æ¸…å•\n\n### 1. è¿ç§»å‰æ£€æŸ¥\n- [ ] å¤‡ä»½ç”Ÿäº§æ•°æ®\n- [ ] åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è¿ç§»\n- [ ] æ£€æŸ¥ä¾èµ–å…³ç³»\n- [ ] è¯„ä¼°åœæœºæ—¶é—´\n- [ ] å‡†å¤‡å›æ»šæ–¹æ¡ˆ\n\n### 2. è¿ç§»æ‰§è¡Œ\n- [ ] æ‰§è¡Œè¿ç§»è„šæœ¬\n- [ ] éªŒè¯æ•°æ®å®Œæ•´æ€§\n- [ ] æ›´æ–°åº”ç”¨é…ç½®\n- [ ] ç›‘æ§ç³»ç»Ÿæ€§èƒ½\n- [ ] è®°å½•è¿ç§»æ—¥å¿—\n\n### 3. è¿ç§»åæ£€æŸ¥\n- [ ] éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸\n- [ ] æ£€æŸ¥æ€§èƒ½æŒ‡æ ‡\n- [ ] æ›´æ–°æ–‡æ¡£\n- [ ] æ¸…ç†ä¸´æ—¶æ–‡ä»¶\n- [ ] é€šçŸ¥ç›¸å…³å›¢é˜Ÿ\n\n## âš ï¸ æ³¨æ„äº‹é¡¹\n\n### 1. å¸¸è§é™·é˜±\n- å¿˜è®°å¤„ç†å¤–é”®çº¦æŸ\n- æ²¡æœ‰è€ƒè™‘æ•°æ®é‡å¤§å°\n- å¿½ç•¥ç´¢å¼•é‡å»ºæ—¶é—´\n- å¿˜è®°æ›´æ–°åº”ç”¨ä»£ç \n\n### 2. æœ€ä½³å®è·µ\n- æ€»æ˜¯æµ‹è¯•è¿ç§»è„šæœ¬\n- ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†è¿ç§»\n- è®°å½•è¯¦ç»†çš„è¿ç§»æ—¥å¿—\n- å‡†å¤‡å›æ»šè®¡åˆ’\n- åœ¨ä½å³°æœŸæ‰§è¡Œè¿ç§»\n\n## ğŸ“š ç›¸å…³èµ„æº\n- [PostgreSQL ALTER TABLE](https://www.postgresql.org/docs/current/sql-altertable.html)\n- [Supabase Migrations](https://supabase.com/docs/guides/database/migrations)\n\n\n","# Postgres SQL Style Guide\n\n## ğŸ¯ ç›®æ ‡\néµå¾ªä¸€è‡´çš„ PostgreSQL SQL ç¼–ç é£æ ¼ï¼Œæé«˜ä»£ç å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚\n\n## ğŸ“ å‘½åçº¦å®š\n\n### 1. è¡¨å\n```sql\n-- âœ… å¥½çš„å‘½å\nusers, user_profiles, order_items, product_categories\n\n-- âŒ é¿å…çš„å‘½å\nUser, userProfile, orderItem, productCategory\n```\n\n### 2. å­—æ®µå\n```sql\n-- âœ… å¥½çš„å‘½å\nuser_id, created_at, is_active, email_address\n\n-- âŒ é¿å…çš„å‘½å\nuserId, createdAt, isActive, emailAddress\n```\n\n### 3. çº¦æŸå\n```sql\n-- âœ… å¥½çš„å‘½å\nfk_users_orders, idx_users_email, uk_users_email, chk_users_age\n\n-- âŒ é¿å…çš„å‘½å\nFK_Users_Orders, idxUsersEmail, UK_Users_Email\n```\n\n### 4. å‡½æ•°å\n```sql\n-- âœ… å¥½çš„å‘½å\nget_user_by_id, calculate_total_amount, validate_email_format\n\n-- âŒ é¿å…çš„å‘½å\ngetUserById, calculateTotalAmount, validateEmailFormat\n```\n\n## ğŸ—ï¸ è¡¨ç»“æ„\n\n### 1. å­—æ®µé¡ºåº\n```sql\nCREATE TABLE users (\n  -- ä¸»é”®\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  \n  -- ä¸šåŠ¡å­—æ®µ\n  email VARCHAR(255) UNIQUE NOT NULL,\n  username VARCHAR(50) UNIQUE NOT NULL,\n  full_name VARCHAR(100),\n  \n  -- çŠ¶æ€å­—æ®µ\n  is_active BOOLEAN DEFAULT true,\n  status VARCHAR(20) DEFAULT 'pending',\n  \n  -- æ—¶é—´å­—æ®µ\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n  \n  -- å¤–é”®\n  role_id UUID REFERENCES roles(id)\n);\n```\n\n### 2. æ•°æ®ç±»å‹é€‰æ‹©\n```sql\n-- âœ… æ¨èçš„æ•°æ®ç±»å‹\nid UUID PRIMARY KEY DEFAULT gen_random_uuid(),           -- ä¸»é”®\nemail VARCHAR(255),                                      -- é‚®ç®±\ndescription TEXT,                                         -- é•¿æ–‡æœ¬\nprice DECIMAL(10,2),                                     -- é‡‘é¢\nis_active BOOLEAN DEFAULT true,                          -- å¸ƒå°”å€¼\ncreated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),       -- æ—¶é—´æˆ³\nmetadata JSONB,                                          -- ç»“æ„åŒ–æ•°æ®\n\n-- âŒ é¿å…çš„æ•°æ®ç±»å‹\nid INTEGER,                                              -- å¯èƒ½æº¢å‡º\nemail CHAR(255),                                         -- å›ºå®šé•¿åº¦æµªè´¹ç©ºé—´\ndescription VARCHAR(1000),                               -- é™åˆ¶é•¿åº¦\nprice FLOAT,                                             -- ç²¾åº¦é—®é¢˜\n```\n\n### 3. çº¦æŸå®šä¹‰\n```sql\n-- âœ… å¥½çš„çº¦æŸå®šä¹‰\nCREATE TABLE orders (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  order_number VARCHAR(20) UNIQUE NOT NULL,\n  total_amount DECIMAL(10,2) NOT NULL CHECK (total_amount > 0),\n  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'confirmed', 'shipped')),\n  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\n-- æ·»åŠ çº¦æŸ\nALTER TABLE orders ADD CONSTRAINT fk_orders_user \n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;\n\nALTER TABLE orders ADD CONSTRAINT chk_orders_amount \n  CHECK (total_amount > 0);\n```\n\n## ğŸ” æŸ¥è¯¢è¯­å¥\n\n### 1. SELECT è¯­å¥\n```sql\n-- âœ… å¥½çš„ SELECT è¯­å¥\nSELECT \n  u.id,\n  u.email,\n  u.full_name,\n  COUNT(o.id) as order_count,\n  SUM(o.total_amount) as total_spent\nFROM users u\nLEFT JOIN orders o ON u.id = o.user_id\nWHERE u.is_active = true\n  AND u.created_at >= '2024-01-01'\nGROUP BY u.id, u.email, u.full_name\nHAVING COUNT(o.id) > 0\nORDER BY total_spent DESC\nLIMIT 100;\n\n-- âŒ é¿å…çš„å†™æ³•\nSELECT * FROM users u, orders o WHERE u.id = o.user_id;\n```\n\n### 2. JOIN è¯­å¥\n```sql\n-- âœ… å¥½çš„ JOIN å†™æ³•\nSELECT \n  u.email,\n  o.order_number,\n  p.name as product_name\nFROM users u\nINNER JOIN orders o ON u.id = o.user_id\nINNER JOIN order_items oi ON o.id = oi.order_id\nINNER JOIN products p ON oi.product_id = p.id\nWHERE u.is_active = true;\n\n-- âŒ é¿å…çš„å†™æ³•\nSELECT u.email, o.order_number, p.name\nFROM users u, orders o, order_items oi, products p\nWHERE u.id = o.user_id AND o.id = oi.order_id AND oi.product_id = p.id;\n```\n\n### 3. å­æŸ¥è¯¢\n```sql\n-- âœ… å¥½çš„å­æŸ¥è¯¢\nSELECT \n  u.email,\n  (SELECT COUNT(*) FROM orders WHERE user_id = u.id) as order_count\nFROM users u\nWHERE u.is_active = true;\n\n-- æˆ–è€…ä½¿ç”¨ EXISTS\nSELECT u.email\nFROM users u\nWHERE EXISTS (\n  SELECT 1 FROM orders o \n  WHERE o.user_id = u.id \n  AND o.status = 'completed'\n);\n\n-- âŒ é¿å…çš„å†™æ³•\nSELECT u.email, COUNT(o.id) as order_count\nFROM users u, orders o\nWHERE u.id = o.user_id(+);  -- Oracle è¯­æ³•\n```\n\n## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ\n\n### 1. å‚æ•°åŒ–æŸ¥è¯¢\n```sql\n-- âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢\nSELECT * FROM users WHERE email = $1 AND status = $2;\n\n-- âŒ å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆæ˜“å— SQL æ³¨å…¥æ”»å‡»ï¼‰\nSELECT * FROM users WHERE email = 'user@example.com' AND status = 'active';\n```\n\n### 2. æƒé™æ§åˆ¶\n```sql\n-- âœ… ä½¿ç”¨ RLS æ§åˆ¶è®¿é—®\nALTER TABLE users ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can view own profile\" ON users\n  FOR SELECT USING (auth.uid() = id);\n\n-- âŒ åœ¨åº”ç”¨å±‚æ§åˆ¶æƒé™\n-- è¿™å¯èƒ½å¯¼è‡´æƒé™ç»•è¿‡\n```\n\n## âš¡ æ€§èƒ½ä¼˜åŒ–\n\n### 1. ç´¢å¼•ç­–ç•¥\n```sql\n-- âœ… å¥½çš„ç´¢å¼•ç­–ç•¥\n-- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•\nCREATE INDEX idx_users_email ON users(email);\nCREATE INDEX idx_users_status ON users(status);\nCREATE INDEX idx_orders_user_status ON orders(user_id, status);\n\n-- éƒ¨åˆ†ç´¢å¼•\nCREATE INDEX idx_users_active ON users(email) WHERE is_active = true;\n\n-- âŒ é¿å…çš„ç´¢å¼•\nCREATE INDEX idx_users_all ON users(id, email, username, full_name);  -- è¿‡åº¦ç´¢å¼•\n```\n\n### 2. æŸ¥è¯¢ä¼˜åŒ–\n```sql\n-- âœ… å¥½çš„æŸ¥è¯¢ä¹ æƒ¯\n-- åªé€‰æ‹©éœ€è¦çš„å­—æ®µ\nSELECT id, email, full_name FROM users WHERE is_active = true;\n\n-- ä½¿ç”¨ LIMIT é™åˆ¶ç»“æœé›†\nSELECT * FROM orders ORDER BY created_at DESC LIMIT 100;\n\n-- é¿å… SELECT *\nSELECT * FROM users;  -- âŒ é€‰æ‹©æ‰€æœ‰å­—æ®µ\n```\n\n## ğŸ“‹ ä»£ç æ ¼å¼åŒ–\n\n### 1. ç¼©è¿›å’Œæ¢è¡Œ\n```sql\n-- âœ… å¥½çš„æ ¼å¼åŒ–\nSELECT \n  u.id,\n  u.email,\n  u.full_name,\n  COUNT(o.id) as order_count\nFROM users u\nLEFT JOIN orders o ON u.id = o.user_id\nWHERE u.is_active = true\n  AND u.created_at >= '2024-01-01'\nGROUP BY \n  u.id, \n  u.email, \n  u.full_name\nHAVING COUNT(o.id) > 0\nORDER BY order_count DESC\nLIMIT 100;\n\n-- âŒ ä¸å¥½çš„æ ¼å¼åŒ–\nSELECT u.id,u.email,u.full_name,COUNT(o.id) as order_count FROM users u LEFT JOIN orders o ON u.id=o.user_id WHERE u.is_active=true AND u.created_at>='2024-01-01' GROUP BY u.id,u.email,u.full_name HAVING COUNT(o.id)>0 ORDER BY order_count DESC LIMIT 100;\n```\n\n### 2. æ³¨é‡Šè§„èŒƒ\n```sql\n-- âœ… å¥½çš„æ³¨é‡Š\n-- è·å–æ´»è·ƒç”¨æˆ·çš„è®¢å•ç»Ÿè®¡\nSELECT \n  u.id,\n  u.email,\n  COUNT(o.id) as order_count\nFROM users u\nLEFT JOIN orders o ON u.id = o.user_id\nWHERE u.is_active = true  -- åªæŸ¥è¯¢æ´»è·ƒç”¨æˆ·\nGROUP BY u.id, u.email;\n\n-- âŒ ä¸å¥½çš„æ³¨é‡Š\n-- æŸ¥è¯¢ç”¨æˆ·\nSELECT * FROM users;  -- æ³¨é‡Šè¿‡äºç®€å•\n```\n\n## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯\n\n### 1. æŸ¥è¯¢æµ‹è¯•\n```sql\n-- âœ… æµ‹è¯•æŸ¥è¯¢\n-- å…ˆæµ‹è¯•å°æ•°æ®é›†\nSELECT COUNT(*) FROM users WHERE is_active = true;\n\n-- ä½¿ç”¨ EXPLAIN åˆ†ææŸ¥è¯¢è®¡åˆ’\nEXPLAIN (ANALYZE, BUFFERS) \nSELECT * FROM users WHERE email = 'test@example.com';\n\n-- âŒ ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œå¤æ‚æŸ¥è¯¢\n```\n\n### 2. æ•°æ®éªŒè¯\n```sql\n-- âœ… æ•°æ®éªŒè¯\n-- æ£€æŸ¥æ•°æ®å®Œæ•´æ€§\nSELECT COUNT(*) FROM users WHERE email IS NULL;\nSELECT COUNT(*) FROM users WHERE username IS NULL;\n\n-- éªŒè¯çº¦æŸ\nSELECT COUNT(*) FROM orders WHERE total_amount <= 0;\n```\n\n## ğŸ“š ç›¸å…³èµ„æº\n- [PostgreSQL Documentation](https://www.postgresql.org/docs/)\n- [Supabase SQL Guide](https://supabase.com/docs/guides/database)\n- [PostgreSQL Style Guide](https://www.postgresql.org/docs/current/style-guide.html)\n\n\n","# Database: Create RLS policies\n\n## ğŸ¯ ç›®æ ‡\nå®ç°è¡Œçº§å®‰å…¨ç­–ç•¥ï¼Œç¡®ä¿æ•°æ®è®¿é—®çš„å®‰å…¨æ€§å’Œéš”ç¦»æ€§ã€‚\n\n## ğŸ”’ RLS åŸºç¡€æ¦‚å¿µ\n\n### 1. å¯ç”¨ RLS\n```sql\n-- ä¸ºè¡¨å¯ç”¨ RLS\nALTER TABLE users ENABLE ROW LEVEL SECURITY;\nALTER TABLE orders ENABLE ROW LEVEL SECURITY;\nALTER TABLE products ENABLE ROW LEVEL SECURITY;\n```\n\n### 2. åˆ›å»ºç­–ç•¥\n```sql\n-- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®\nCREATE POLICY \"Users can view own profile\" ON users\n  FOR SELECT USING (auth.uid() = id);\n\nCREATE POLICY \"Users can update own profile\" ON users\n  FOR UPDATE USING (auth.uid() = id);\n\n-- ç”¨æˆ·åªèƒ½åˆ›å»ºè‡ªå·±çš„è®¢å•\nCREATE POLICY \"Users can create own orders\" ON orders\n  FOR INSERT WITH CHECK (auth.uid() = user_id);\n\n-- ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„è®¢å•\nCREATE POLICY \"Users can view own orders\" ON orders\n  FOR SELECT USING (auth.uid() = user_id);\n```\n\n## ğŸ—ï¸ ç­–ç•¥æ¨¡å¼\n\n### 1. åŸºäºç”¨æˆ· ID çš„ç­–ç•¥\n```sql\n-- ç”¨æˆ·è¡¨ç­–ç•¥\nCREATE POLICY \"Users can manage own data\" ON users\n  FOR ALL USING (auth.uid() = id);\n\n-- è®¢å•è¡¨ç­–ç•¥\nCREATE POLICY \"Users can manage own orders\" ON orders\n  FOR ALL USING (auth.uid() = user_id);\n\n-- äº§å“è¡¨ç­–ç•¥ï¼ˆåªè¯»ï¼‰\nCREATE POLICY \"Users can view products\" ON products\n  FOR SELECT USING (true);\n```\n\n### 2. åŸºäºè§’è‰²çš„ç­–ç•¥\n```sql\n-- ç®¡ç†å‘˜ç­–ç•¥\nCREATE POLICY \"Admins can manage all data\" ON users\n  FOR ALL USING (\n    EXISTS (\n      SELECT 1 FROM user_roles \n      WHERE user_id = auth.uid() \n      AND role = 'admin'\n    )\n  );\n\n-- æ™®é€šç”¨æˆ·ç­–ç•¥\nCREATE POLICY \"Users can view public data\" ON products\n  FOR SELECT USING (is_public = true);\n```\n\n### 3. åŸºäºçŠ¶æ€çš„ç­–ç•¥\n```sql\n-- æ´»è·ƒç”¨æˆ·ç­–ç•¥\nCREATE POLICY \"Active users can access premium features\" ON premium_content\n  FOR SELECT USING (\n    EXISTS (\n      SELECT 1 FROM users \n      WHERE id = auth.uid() \n      AND is_active = true \n      AND subscription_status = 'active'\n    )\n  );\n```\n\n## ğŸ” é«˜çº§ç­–ç•¥\n\n### 1. æ—¶é—´é™åˆ¶ç­–ç•¥\n```sql\n-- é™åˆ¶è®¿é—®æ—¶é—´\nCREATE POLICY \"Business hours access\" ON sensitive_data\n  FOR SELECT USING (\n    EXTRACT(HOUR FROM NOW()) BETWEEN 9 AND 17\n  );\n```\n\n### 2. åœ°ç†ä½ç½®ç­–ç•¥\n```sql\n-- åŸºäº IP åœ°å€çš„ç­–ç•¥\nCREATE POLICY \"Local access only\" ON internal_data\n  FOR SELECT USING (\n    inet_client_addr() <<= '192.168.0.0/16'\n  );\n```\n\n### 3. æ•°æ®æ•æ„Ÿåº¦ç­–ç•¥\n```sql\n-- åŸºäºæ•°æ®æ•æ„Ÿåº¦çš„ç­–ç•¥\nCREATE POLICY \"Sensitive data access\" ON user_profiles\n  FOR SELECT USING (\n    CASE \n      WHEN auth.uid() = user_id THEN true\n      WHEN is_public = true THEN true\n      WHEN EXISTS (\n        SELECT 1 FROM user_roles \n        WHERE user_id = auth.uid() \n        AND role IN ('admin', 'moderator')\n      ) THEN true\n      ELSE false\n    END\n  );\n```\n\n## ğŸ§ª æµ‹è¯•ç­–ç•¥\n\n### 1. ç­–ç•¥æµ‹è¯•\n```sql\n-- æµ‹è¯•ç”¨æˆ·ç­–ç•¥\n-- ä»¥ç”¨æˆ·èº«ä»½è¿æ¥\nSET LOCAL ROLE authenticated;\nSET LOCAL \"request.jwt.claim.sub\" TO 'user-uuid';\n\n-- æµ‹è¯•æŸ¥è¯¢\nSELECT * FROM users WHERE id = 'user-uuid';\nSELECT * FROM users WHERE id != 'user-uuid'; -- åº”è¯¥è¿”å›ç©º\n```\n\n### 2. ç­–ç•¥éªŒè¯\n```sql\n-- æŸ¥çœ‹è¡¨çš„ç­–ç•¥\nSELECT schemaname, tablename, policyname, permissive, roles, cmd, qual\nFROM pg_policies \nWHERE tablename = 'users';\n\n-- æŸ¥çœ‹ RLS çŠ¶æ€\nSELECT schemaname, tablename, rowsecurity \nFROM pg_tables \nWHERE tablename = 'users';\n```\n\n## âš ï¸ æ³¨æ„äº‹é¡¹\n\n### 1. æ€§èƒ½è€ƒè™‘\n- ç­–ç•¥å‡½æ•°åº”è¯¥é«˜æ•ˆæ‰§è¡Œ\n- é¿å…å¤æ‚çš„å­æŸ¥è¯¢\n- ä½¿ç”¨é€‚å½“çš„ç´¢å¼•\n\n### 2. è°ƒè¯•æŠ€å·§\n- ä½¿ç”¨ `EXPLAIN` åˆ†æç­–ç•¥æ‰§è¡Œ\n- æ£€æŸ¥ç­–ç•¥æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ\n- éªŒè¯ç”¨æˆ·æƒé™è®¾ç½®\n\n### 3. å¸¸è§é™·é˜±\n- å¿˜è®°å¯ç”¨ RLS\n- ç­–ç•¥è¿‡äºå¤æ‚\n- æ²¡æœ‰æµ‹è¯•æ‰€æœ‰åœºæ™¯\n\n## ğŸ“š ç›¸å…³èµ„æº\n- [PostgreSQL RLS Documentation](https://www.postgresql.org/docs/current/ddl-rowsecurity.html)\n- [Supabase RLS Guide](https://supabase.com/docs/guides/auth/row-level-security)\n\n\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAA;;;ACAA;;;ACAA;;;ACAA;;;ACAA;;;ACAA;;;ACAA;;;ACAA;;;ARiBA,IAAM,UAAyB;AAAA,EAC7B;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS;AAAA,EACX;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS;AAAA,EACX;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS;AAAA,EACX;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS;AAAA,EACX;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS;AAAA,EACX;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS;AAAA,EACX;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS;AAAA,EACX;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS;AAAA,EACX;AACF;AAQO,IAAM,kBAAN,MAAsB;AAAA;AAAA;AAAA;AAAA,EAK3B,MAAM,gBAAyC;AAC7C,WAAO,QAAQ,IAAI,KAAK,SAAS;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAMQ,YAAY,CAAC,WAAsC;AAAA,IACzD,MAAM,MAAM;AAAA,IACZ,aAAa,MAAM;AAAA,IACnB,SAAS,MAAM;AAAA,EACjB;AACF;AAGO,IAAM,kBAAkB,IAAI,gBAAgB;","names":[]}